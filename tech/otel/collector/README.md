# OpenTelemety Collector

- Vendor-agnostic way to receive, process and export telemetry data.
![otel-colelctor](../../../images/otel-collector.svg)

## Introduction

- The `OpenTelemetry Collector` offers a *vendor-agnostic implementation* of how to `receive`, `process` and `export` telemetry data. It removes the need to *run*, *operate*, and *maintain* **multiple agents/collectors**. This works with improved *scalability* and supports open source observability data formats (e.g. `Jaeger`, `Prometheus`, `Fluent Bit`, etc.) sending to one or more open source or *commercial backends*.

## Objectives

- *Usability*: Reasonable default configuration, supports popular protocols, runs and collects out of the box.
- *Performance*: Highly stable and performant under varying loads and configurations.
- *Observability*: An exemplar of an observable service.
- *Extensibility*: Customizable without touching the core code.
- *Unification*: Single codebase, deployable as an agent or collector with support for `traces`, `metrics`, and `logs`.

## Installation

- Install from source or download pre-built binaries from the [releases page](https://github.com/open-telemetry/opentelemetry-collector-releases) and follow steps in [here](https://www.fosstechnix.com/setup-opentelemetry-collector-on-ubuntu/)

```bash
wget https://github.com/open-telemetry/opentelemetry-collector-releases/releases/download/{VERSION}/{VERSION_FILE}.deb
sudo dpkg -i {VERSION_FILE}.deb
```

File `/etc/otelcol-contrib/config.yaml` configuration `OpenTelemety Collector` can be found [here](https://opentelemetry.io/docs/collector/configuration/)

- For Docker installation, refer to the [Docker Hub page](https://hub.docker.com/r/otel/opentelemetry-collector). You can install by docker-compose as well:

```yaml
services:
  otel-collector:
    image: otel/opentelemetry-collector-contrib:0.138.0
    container_name: otel-collector
    command: ["--config=/etc/otel/config.yaml"]
    volumes:
      - ./collector-config.yaml:/etc/otel/config.yaml
    ports:
      - "4317:4317" # OTLP gRPC
      - "13133:13133" # Health check
      - "1777:1777" # pprof
      - "55679:55679" # zpages
      - "8888:8888" # prometheus scrape metrics from otel collector
      - "9464:9464" # Prometheus scrape metrics from apllication generated by otel
```

- You can deployment `OpenTelemetry Collector` with `No Collector`, `Agent`, `Gateway`, and `Collector` modes. More details can be found [here](https://opentelemetry.io/docs/collector/deployment/)

## Configuration

### Configuration Structure

- The structure of any Collector configuration file consists of four classes of pipeline components that access telemetry data:
  - [Receivers](https://opentelemetry.io/docs/collector/configuration/#receivers): These components receive data from various sources, such as applications or other collectors.
  - [Processors](https://opentelemetry.io/docs/collector/configuration/#processors): These components process the data, which may include filtering, batching, or
  - [Exporters](https://opentelemetry.io/docs/collector/configuration/#exporters): These components send the processed data to various backends or storage systems.
  - [Connectors](https://opentelemetry.io/docs/collector/configuration/#connectors): These components connect different parts of the pipeline, allowing data to flow between receivers, processors, and exporters.

```yaml
receivers:
  otlp:
    protocols:
      grpc:
        endpoint: 0.0.0.0:4317
      http:
        endpoint: 0.0.0.0:4318
processors:
  batch:

exporters:
  otlp:
    endpoint: otelcol:4317

extensions:
  health_check:
    endpoint: 0.0.0.0:13133
  pprof:
    endpoint: 0.0.0.0:1777
  zpages:
    endpoint: 0.0.0.0:55679

service:
  extensions: [health_check, pprof, zpages]
  pipelines:
    traces:
      receivers: [otlp]
      processors: [batch]
      exporters: [otlp]
    metrics:
      receivers: [otlp]
      processors: [batch]
      exporters: [otlp]
    logs:
      receivers: [otlp]
      processors: [batch]
      exporters: [otlp]
```

## Internal telemetry

- You can inspect the health of any `OpenTelemetry Collector` instance by checking its own internal telemetry. Read on to learn about this telemetry and how to configure it to help you [monitor](https://opentelemetry.io/docs/collector/internal-telemetry/#use-internal-telemetry-to-monitor-the-collector) and troubleshoot the [Collector](https://opentelemetry.io/docs/collector/troubleshooting/).

### Configure internal metrics

- You can configure how internal metrics are generated and exposed by the `Collector`. By default, the `Collector` generates basic metrics about itself and exposes them using the `OpenTelemetry Go Prometheus exporter` for scraping at `http://127.0.0.1:8888/metrics`.
- The `Collector` can push its internal metrics to an `OTLP backend` via the following configuration:

```yaml
service:
  telemetry:
    metrics:
    metrics:
      # level: detailed
      readers:
        - pull:
            exporter:
              prometheus:
                host: "0.0.0.0"
                port: 8888
```

### Configure internal logs

- The following configuration can be used to emit internal logs from the Collector to an `OTLP/HTTP backend`:

```yaml
service:
  telemetry:
    logs:
      processors:
        - batch:
            exporter:
              otlp:
                protocol: http/protobuf
                endpoint: https://backend:4318
```

### Configure internal traces

- The Collector does not expose traces by default, but it can be configured to. The following configuration can be used to emit internal traces from the Collector to an `OTLP backend`:

```yaml
service:
  telemetry:
    traces:
      processors:
        - batch:
            exporter:
              otlp:
                protocol: http/protobuf
                endpoint: https://backend:4318
```
